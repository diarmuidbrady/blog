<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Diarmuid Brady">
<meta name="dcterms.date" content="2024-05-24">

<title>Blog - Can ChatGPT Be Trusted? Part 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../icon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/diarmuidbrady/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://instagram.com/thetenaciouslife_"> <i class="bi bi-instagram" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Can ChatGPT Be Trusted? Part 2</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Can ChatGPT Be Trusted?</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Diarmuid Brady </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 24, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>ChatGPT can waffle through subjective questions, but precise details expose its flaws.</p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction"><strong>Introduction</strong></h2>
<p>We’ve explored ChatGPT’s knowledge of each instrument’s role in a soundtrack’s composition while examining “<em>Why Do We Fall</em>” from The Dark Knight Rises in Part 1. In this blog, we will evaluate ChatGPT from another perspective: how a soundtrack complements a theme that spans across the Captain America trilogy.</p>
</section>
<section id="taking-a-stand---captain-america-the-winter-soldier-henry-jackman" class="level2">
<h2 class="anchored" data-anchor-id="taking-a-stand---captain-america-the-winter-soldier-henry-jackman"><em>Taking A Stand</em> - Captain America: The Winter Soldier (Henry Jackman)</h2>
<p>Captain America: The Winter Soldier is my favourite movie. In this movie, Captain America (Steve Rogers) struggles to find his footing in the modern world after being under the ice for 70 years. While coming to terms with this new world, he uncovers unsettling secrets about the people he had once laid down his life for. The composition “Taking a Stand” accompanies the pivotal scene when Steve is on the run from S.H.I.E.L.D. They cast him as a traitor after he finds out about Hydra’s roots within S.H.I.E.L.D’s organisation and pursues what he believes is right. This is a key moment in the Winter Soldier and Steve’s character arc across the Marvel Cinematic Universe. This scene builds upon the scene in Captain America: The First Avenger when he disobeys direct orders against infiltrating the Hydra base to free his captured comrades. Steve exercises his own judgement and continues the path to becoming an independent character with his own set of values. We see this come to a head in Captain America: Civil War when he opposes the Sokovia Accords. I expect ChatGPT to discuss these key motifs and themes.</p>
<details>
<summary>
My Prompt
</summary>
<p><em>Imagine you are a film score and soundtrack expert who has an undying passion for analysing the meaning behind the music composed for movies and films. You have studied the character of Steve Rogers (Captain America) specifically in the Marvel Cinematic Universe.</em></p>
<em>I want you to discuss the importance of the piece of music “Taking a Stand” in Captain America: The Winter Soldier for forwarding the plot and the role it plays in developing Steve’s character arc in the MCU.</em>
</details>
<details>
<summary>
ChatGPT’s Response
</summary>
<p><em>As a film score and soundtrack expert, I can confidently say that music plays a vital role in shaping the emotional impact of a movie or film. The piece of music “Taking a Stand” from Captain America: The Winter Soldier is a perfect example of how music can forward the plot while also contributing to the character development of the protagonist, Steve Rogers.</em></p>
<p><em>The piece of music “Taking a Stand” is a recurring theme throughout the film, representing the heroic nature of Captain America and his unwavering dedication to standing up for what is right. The music is first introduced during the opening action sequence, where Steve, aka Captain America, and his team of S.H.I.E.L.D agents rescue hostages from pirates on the Lemurian Star. The music sets the tone for the rest of the film, establishing Captain America as a symbol of hope and justice.</em></p>
<p><em>Throughout the film, we see Steve struggling to reconcile his old-fashioned values with the complex and morally ambiguous world he finds himself in. He is forced to question his loyalty to S.H.I.E.L.D. and the government and faces betrayal from those he once trusted. The music “Taking a Stand” serves as a reminder of his unwavering moral compass and his commitment to standing up for what is right, even in the face of adversity.</em></p>
<p><em>In the film’s climactic scene, where Steve and his friend Sam Wilson confront the Winter Soldier, the music swells to a crescendo, emphasising the gravity of the situation and the high stakes involved. The music is a testament to Steve’s growth as a character, showing how he has evolved from a simple soldier to a true leader who inspires those around him to do the right thing.</em></p>
<em>In conclusion, the piece of music “Taking a Stand” is a critical element of Captain America: The Winter Soldier’s soundtrack, both forwarding the plot and contributing to the development of Steve’s character arc. The music serves as a powerful reminder of Steve’s unwavering dedication to standing up for what is right, even in the face of impossible odds, making him a true hero and an inspiration to audiences worldwide.</em>
</details>
<p>ChatGPT begins by agreeing with me about the importance of the piece of music. Unfortunately, ChatGPT misses that “Taking a Stand” is a distinct piece that accompanies a specific action sequence in the film. Instead, ChatGPT takes “Taking a Stand” as more of a musical theme and reflection of Steve’s character traits. “Taking a Stand” is not introduced in the opening scene, “Lemurian Star” is. It is not played in the final scene either.</p>
<p>ChatGPT is not recognising “Taking a Stand” as a standalone piece of music and instead as a broader theme in Captain America: The Winter Soldier. This is disappointing. A standalone composition in an action movie is rare. Action music is usually formulaic, echoing familiar patterns.</p>
<p>ChatGPT comments that the music illustrates Steve’s character growth “from a simple soldier to a true leader”. This is a hallmark of his character. Let’s explore this further.</p>
<details>
<summary>
Second Prompt
</summary>
<em>Can you give examples of unwavering dedication to standing up for what is right, even in the face of impossible odds from the whole Trilogy and how the role the piece of music “Taking a Stand” (played during his escape from the S.H.I.E.L.D. compound) plays among these examples.”</em>
</details>
<details>
<summary>
ChatGPT’s Response
</summary>
<p>*Certainly, there are several examples throughout the Captain America Trilogy that demonstrate Steve Rogers’ unwavering dedication to standing up for what is right, even in the face of impossible odds.</p>
<p>One such example is in Captain America: The First Avenger, where Steve, despite being physically weak and frail, repeatedly tries to enlist in the military to fight in World War II. His persistence and determination eventually lead him to be selected for a top-secret government experiment that turns him into the super-soldier Captain America. The music “Taking a Stand” is not present in this film, but we can see how Steve’s unwavering dedication is a constant theme throughout his journey.</p>
<p>Another example is in Captain America: The Winter Soldier, where Steve becomes disillusioned with S.H.I.E.L.D.’s actions and uncovers a conspiracy within the organisation. Despite facing seemingly insurmountable odds, Steve decides to take a stand against those who would use their power for personal gain, ultimately leading to the collapse of S.H.I.E.L.D. The piece of music “Taking a Stand” plays during Steve’s escape from the S.H.I.E.L.D. compound, emphasising the gravity of the situation and the stakes involved. The music also highlights Steve’s determination to do what is right, even if it means going against authority figures he once trusted.</p>
<p>In Captain America: Civil War, Steve once again finds himself at odds with his former teammates in the Avengers, who have aligned themselves with the government’s demands for accountability. Despite being on the run and facing a powerful new enemy, Steve remains committed to his beliefs and refuses to compromise his principles. The piece of music “Taking a Stand” plays during the final battle between Steve and Iron Man, underscoring the emotional weight of the confrontation and Steve’s conviction in his actions.</p>
In conclusion, the piece of music “Taking a Stand” serves as a recurring theme throughout the Captain America Trilogy, emphasising Steve Rogers’ unwavering dedication to standing up for what is right, even in the face of seemingly impossible odds. From his persistence in enlisting in the military to his fight against corrupt organisations, Steve’s commitment to his beliefs is a constant thread throughout his journey, and the music serves as a powerful reminder of his heroism and bravery.”*
</details>
<p>I’m satisfied with this response. ChatGPT provides examples from each movie of Captain America’s independence and integrity. It identifies its presence in <em>The Winter Solider</em>, and absence in <em>The First Avenger</em>, but it makes a mistake with when it says it was in the final battle of Captain America: Civil War. The final battle scene was underscored by the piece “Clash”. In this analysis, ChatGPT describes how a soundtrack impacts character themes but struggles with placing the sountrack in the right moment of the film. Saying it another way, ChatGPT can describe niche topics subjectively but not precisely. Niche topics lack training data. Therefore, performance on precise, complex tasks lags in these areas. This is the crux of the hallucination problem. For subjective questions, there is no true right answer and ChatGPT can get away with “<em>waffling</em>”. But questions with only one true answer stifle ChatGPT. We can demonstrate this when posing complex maths problems to ChatGPT. There is almost always error. It’s plausible to attribute this to its stochastic nature.</p>
</section>
<section id="recap" class="level2">
<h2 class="anchored" data-anchor-id="recap">Recap</h2>
<p>To recap, here is a breakdown of the results.</p>
<p>ChatGPT…</p>
<p>❌&nbsp;&nbsp;&nbsp;&nbsp;Treated “<em>Taking a Stand</em>” as a theme rather than a music composition.</p>
<p>✅&nbsp;&nbsp;&nbsp;&nbsp;Discussed the key themes of Steve Roger’s character arc.</p>
<p>❌&nbsp;&nbsp;&nbsp;&nbsp;Mistook “<em>Taking a Stand</em>” playing at incorrect moments in The Winter Soldier (the start and the end) and in the wrong movies (Civil War).</p>
<p>✅&nbsp;&nbsp;&nbsp;&nbsp;Describes a moment in all three Captain America films where Steve stands up for his own values.</p>
</section>
<section id="takeaways" class="level2">
<h2 class="anchored" data-anchor-id="takeaways">Takeaways:</h2>
<p>💡&nbsp;&nbsp;&nbsp;&nbsp;ChatGPT can waffle through subjective questions, but precise details expose its flaws.</p>
<p>In this analysis, we identified a key flaw in ChatGPT’s abilities, its poor precision on niche subject matter. The final part tasks ChatGPT with a comparative analysis between the soundtracks of two films and it’s greatest strength is discovered.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/diarmuidbrady\.github\.io\/blog\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>